{% extends "base.html" %}

{% block title %}Cap√≠tulo 1 - B√∫squeda de Ra√≠ces{% endblock %}

{% block header_title %}Cap√≠tulo 1: B√∫squeda de Ra√≠ces{% endblock %}
{% block header_subtitle %}M√©todos para encontrar ra√≠ces de funciones{% endblock %}

{% block content %}
<div class="metodos-container">
    <div class="metodos-sidebar">
        <h3>M√©todos Disponibles</h3>
        <button class="metodo-btn active" onclick="cambiarMetodo('biseccion')">Bisecci√≥n</button>
        <button class="metodo-btn" onclick="cambiarMetodo('regla-falsa')">Regla Falsa</button>
        <button class="metodo-btn" onclick="cambiarMetodo('punto-fijo')">Punto Fijo</button>
        <button class="metodo-btn" onclick="cambiarMetodo('newton')">Newton-Raphson</button>
        <button class="metodo-btn" onclick="cambiarMetodo('secante')">Secante</button>
        <button class="metodo-btn" onclick="cambiarMetodo('raices-multiples')">Ra√≠ces M√∫ltiples</button>
        <hr style="margin: 20px 0; border: 1px solid #e0e0e0;">
        <button class="metodo-btn" onclick="cambiarMetodo('informe')" style="background: #27ae60; color: white;">üìä Generar Informe</button>
    </div>

    <div class="metodo-content">
        <!-- Ayuda General -->
        <div class="ayuda-general-banner">
            <button class="ayuda-toggle" onclick="toggleAyudaGeneral()">
                üìñ ¬øC√≥mo escribir funciones? (Click para ayuda)
            </button>
            <div id="ayuda-general-content" class="ayuda-general-content" style="display: none;">
                <h3>üìö Gu√≠a de Sintaxis de Funciones</h3>

                <div class="ayuda-section">
                    <h4>üî¢ Operadores B√°sicos</h4>
                    <table class="syntax-table">
                        <tr><th>Operaci√≥n</th><th>Sintaxis</th><th>Ejemplo</th></tr>
                        <tr><td>Suma</td><td><code>+</code></td><td><code>x + 5</code></td></tr>
                        <tr><td>Resta</td><td><code>-</code></td><td><code>x - 3</code></td></tr>
                        <tr><td>Multiplicaci√≥n</td><td><code>*</code></td><td><code>2*x</code> o <code>x*y</code></td></tr>
                        <tr><td>Divisi√≥n</td><td><code>/</code></td><td><code>x/2</code> o <code>1/x</code></td></tr>
                        <tr><td>Potencia</td><td><code>**</code></td><td><code>x**2</code> (x¬≤), <code>x**3</code> (x¬≥)</td></tr>
                        <tr><td>Ra√≠z</td><td><code>**(1/n)</code></td><td><code>x**(1/2)</code> (‚àöx), <code>x**(1/3)</code> (‚àõx)</td></tr>
                    </table>
                </div>

                <div class="ayuda-section">
                    <h4>üìê Funciones Matem√°ticas</h4>
                    <table class="syntax-table">
                        <tr><th>Funci√≥n</th><th>Sintaxis</th><th>Ejemplo</th></tr>
                        <tr><td>Seno</td><td><code>sin(x)</code></td><td><code>sin(x) - x/2</code></td></tr>
                        <tr><td>Coseno</td><td><code>cos(x)</code></td><td><code>cos(x) - x</code></td></tr>
                        <tr><td>Tangente</td><td><code>tan(x)</code></td><td><code>tan(x) - x</code></td></tr>
                        <tr><td>Exponencial</td><td><code>exp(x)</code></td><td><code>exp(x) - 3*x</code></td></tr>
                        <tr><td>Logaritmo natural</td><td><code>log(x)</code></td><td><code>log(x) - 2</code></td></tr>
                        <tr><td>Ra√≠z cuadrada</td><td><code>sqrt(x)</code></td><td><code>sqrt(x) - 5</code></td></tr>
                        <tr><td>Valor absoluto</td><td><code>abs(x)</code></td><td><code>abs(x) - 3</code></td></tr>
                    </table>
                </div>

                <div class="ayuda-section">
                    <h4>‚úçÔ∏è Ejemplos Completos</h4>
                    <ul class="ejemplos-list">
                        <li><code>x**3 - 2*x - 5</code> ‚Üí Polinomio c√∫bico</li>
                        <li><code>x**2 - 4</code> ‚Üí Tiene ra√≠ces en x=2 y x=-2</li>
                        <li><code>sin(x) - x/2</code> ‚Üí Funci√≥n trigonom√©trica</li>
                        <li><code>exp(x) - 3*x</code> ‚Üí Funci√≥n exponencial</li>
                        <li><code>log(x) - 1/x</code> ‚Üí Combinaci√≥n logaritmo y fracci√≥n</li>
                        <li><code>(x + 2)**(1/3)</code> ‚Üí Ra√≠z c√∫bica de (x+2)</li>
                        <li><code>x**3 - x - 2</code> ‚Üí Otra funci√≥n polinomial</li>
                    </ul>
                </div>

                <div class="ayuda-section">
                    <h4>üßÆ Sobre las Derivadas</h4>
                    <div class="info-box">
                        <p><strong>¬°Buenas noticias!</strong> En los m√©todos de Newton-Raphson y Ra√≠ces M√∫ltiples, <strong>NO necesitas calcular la derivada manualmente</strong>.</p>
                        <p>El sistema calcula autom√°ticamente:</p>
                        <ul>
                            <li><strong>f'(x)</strong> - Primera derivada</li>
                            <li><strong>f''(x)</strong> - Segunda derivada (para Ra√≠ces M√∫ltiples)</li>
                        </ul>
                        <p>Por ejemplo, si ingresas: <code>f(x) = x**3 - 2*x - 5</code></p>
                        <p>El sistema calcula autom√°ticamente: <code>f'(x) = 3*x**2 - 2</code></p>
                        <p class="tip">üí° <strong>Tip:</strong> Los resultados mostrar√°n la derivada calculada para que puedas verificarla.</p>
                    </div>
                </div>

                <div class="ayuda-section">
                    <h4>‚ö†Ô∏è Errores Comunes</h4>
                    <ul class="errores-list">
                        <li>‚ùå <code>2x</code> ‚Üí ‚úÖ <code>2*x</code> (siempre usa * para multiplicar)</li>
                        <li>‚ùå <code>x^2</code> ‚Üí ‚úÖ <code>x**2</code> (usa ** para potencias)</li>
                        <li>‚ùå <code>‚àöx</code> ‚Üí ‚úÖ <code>sqrt(x)</code> o <code>x**(1/2)</code></li>
                        <li>‚ùå <code>ln(x)</code> ‚Üí ‚úÖ <code>log(x)</code> (log es logaritmo natural)</li>
                        <li>‚ùå <code>e^x</code> ‚Üí ‚úÖ <code>exp(x)</code></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Bisecci√≥n -->
        <div id="biseccion" class="metodo-panel active">
            <h2>M√©todo de Bisecci√≥n</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>El m√©todo de bisecci√≥n encuentra ra√≠ces en un intervalo [Xi, Xs] donde f(Xi) y f(Xs) tienen signos opuestos.</p>
                <p><strong>Este ejemplo:</strong> f(x) = x¬≥ - 2x - 5 tiene una ra√≠z en [2, 3] ‚âà 2.0946</p>
            </div>
            <form id="form-biseccion" onsubmit="event.preventDefault(); ejecutarMetodo('biseccion');">
                <div class="form-row">
                    <div class="form-group">
                        <label>Xi (l√≠mite inferior):</label>
                        <input type="number" step="any" name="xi" value="2" required>
                    </div>
                    <div class="form-group">
                        <label>Xs (l√≠mite superior):</label>
                        <input type="number" step="any" name="xs" value="3" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="5e-5" required>
                        <small><strong>IMPORTANTE:</strong> Solo son v√°lidos <strong>5e-X</strong> (Cifras Significativas) o <strong>0.5e-X</strong> (Decimales Correctos). Otros formatos como 1e-5 se tratar√°n como tolerancia gen√©rica.</small>
                    </div>
                    <div class="form-group">
                        <label>Iteraciones m√°ximas:</label>
                        <input type="number" name="niter" value="100" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="x**3 - 2*x - 5" required>
                    <small>Otros ejemplos: x**2-4, sin(x)-x/2, exp(x)-3*x, x**3-x-2</small>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-biseccion" class="loading"><div class="spinner"></div></div>
            <div id="resultados-biseccion" class="results-section"></div>
            <div id="grafica-biseccion" class="chart-container"></div>
        </div>

        <!-- Regla Falsa -->
        <div id="regla-falsa" class="metodo-panel">
            <h2>M√©todo de Regla Falsa</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>Similar a bisecci√≥n, pero usa interpolaci√≥n lineal para aproximar mejor la ra√≠z.</p>
                <p><strong>Este ejemplo:</strong> Converge m√°s r√°pido que bisecci√≥n (‚âà9 iteraciones vs ‚âà16)</p>
            </div>
            <form id="form-regla-falsa" onsubmit="event.preventDefault(); ejecutarMetodo('regla-falsa');">
                <div class="form-row">
                    <div class="form-group">
                        <label>Xi:</label>
                        <input type="number" step="any" name="xi" value="2" required>
                    </div>
                    <div class="form-group">
                        <label>Xs:</label>
                        <input type="number" step="any" name="xs" value="3" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="5e-5" required>
                        <small><strong>IMPORTANTE:</strong> Solo son v√°lidos <strong>5e-X</strong> (Cifras Significativas) o <strong>0.5e-X</strong> (Decimales Correctos). Otros formatos como 1e-5 se tratar√°n como tolerancia gen√©rica.</small>
                    </div>
                    <div class="form-group">
                        <label>Iteraciones m√°ximas:</label>
                        <input type="number" name="niter" value="100" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="x**3 - 2*x - 5" required>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-regla-falsa" class="loading"><div class="spinner"></div></div>
            <div id="resultados-regla-falsa" class="results-section"></div>
            <div id="grafica-regla-falsa" class="chart-container"></div>
        </div>

        <!-- Newton-Raphson -->
        <div id="newton" class="metodo-panel">
            <h2>M√©todo de Newton-Raphson</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>Usa la derivada para converger r√°pidamente. Requiere un valor inicial cercano a la ra√≠z.</p>
                <p><strong>Nota:</strong> La derivada se calcula autom√°ticamente.</p>
            </div>
            <form id="form-newton" onsubmit="event.preventDefault(); ejecutarMetodo('newton');">
                <div class="form-row">
                    <div class="form-group">
                        <label>x0 (valor inicial):</label>
                        <input type="number" step="any" name="x0" value="2.5" required>
                    </div>
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="0.5e-5" required>
                        <small>Este m√©todo usa solo <strong>error absoluto (0.5e-X)</strong></small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Iteraciones m√°ximas:</label>
                    <input type="number" name="niter" value="100" required>
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="x**3 - 2*x - 5" required>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-newton" class="loading"><div class="spinner"></div></div>
            <div id="resultados-newton" class="results-section"></div>
            <div id="grafica-newton" class="chart-container"></div>
        </div>

        <!-- Punto Fijo -->
        <div id="punto-fijo" class="metodo-panel">
            <h2>M√©todo de Punto Fijo</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>Transforma f(x)=0 en x=g(x) y usa iteraci√≥n xn+1 = g(xn).</p>
                <p><strong>Este ejemplo:</strong> Para f(x)=x¬≥-x-2=0, usamos g(x)=(x+2)^(1/3). Ra√≠z ‚âà 1.5214</p>
            </div>
            <form id="form-punto-fijo" onsubmit="event.preventDefault(); ejecutarMetodo('punto-fijo');">
                <div class="form-row">
                    <div class="form-group">
                        <label>x0 (valor inicial):</label>
                        <input type="number" step="any" name="x0" value="1.5" required>
                    </div>
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="0.5e-5" required>
                        <small>Este m√©todo usa solo <strong>error absoluto (0.5e-X)</strong></small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Iteraciones m√°ximas:</label>
                    <input type="number" name="niter" value="100" required>
                </div>
                <div class="form-group">
                    <label>Funci√≥n g(x) - Iteraci√≥n:</label>
                    <input type="text" name="funcion_g" value="(x + 2)**(1/3)" required>
                    <small>Debe cumplir x = g(x). Otro ejemplo: Para cos(x)-x=0, usar g(x)=cos(x)</small>
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x) - Original:</label>
                    <input type="text" name="funcion_f" value="x**3 - x - 2" required>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-punto-fijo" class="loading"><div class="spinner"></div></div>
            <div id="resultados-punto-fijo" class="results-section"></div>
            <div id="grafica-punto-fijo" class="chart-container"></div>
        </div>

        <!-- Secante -->
        <div id="secante" class="metodo-panel">
            <h2>M√©todo de la Secante</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>Aproxima la derivada usando dos puntos anteriores. No requiere calcular la derivada.</p>
                <p><strong>Este ejemplo:</strong> f(x)=x¬≥-x-2=0 con x0=1, x1=2. Ra√≠z ‚âà 1.5214 en ~6 iteraciones</p>
            </div>
            <form id="form-secante" onsubmit="event.preventDefault(); ejecutarMetodo('secante');">
                <div class="form-row">
                    <div class="form-group">
                        <label>x0 (primer valor):</label>
                        <input type="number" step="any" name="x0" value="1" required>
                    </div>
                    <div class="form-group">
                        <label>x1 (segundo valor):</label>
                        <input type="number" step="any" name="x1" value="2" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="5e-5" required>
                        <small><strong>IMPORTANTE:</strong> Solo son v√°lidos <strong>5e-X</strong> (Cifras Significativas) o <strong>0.5e-X</strong> (Decimales Correctos). Otros formatos como 1e-5 se tratar√°n como tolerancia gen√©rica.</small>
                    </div>
                    <div class="form-group">
                        <label>Iteraciones m√°ximas:</label>
                        <input type="number" name="niter" value="100" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="x**3 - x - 2" required>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-secante" class="loading"><div class="spinner"></div></div>
            <div id="resultados-secante" class="results-section"></div>
            <div id="grafica-secante" class="chart-container"></div>
        </div>

        <!-- Ra√≠ces M√∫ltiples -->
        <div id="raices-multiples" class="metodo-panel">
            <h2>M√©todo de Newton para Ra√≠ces M√∫ltiples</h2>
            <div class="help-box">
                <h4>Ayuda</h4>
                <p>Para ra√≠ces con multiplicidad mayor a 1. Usa segunda derivada o multiplicidad conocida.</p>
                <p><strong>Este ejemplo:</strong> f(x)=(x-1)¬≥ tiene ra√≠z triple en x=1. Converge en 1 iteraci√≥n.</p>
            </div>
            <form id="form-raices-multiples" onsubmit="event.preventDefault(); ejecutarMetodo('raices-multiples');">
                <div class="form-row">
                    <div class="form-group">
                        <label>x0 (valor inicial):</label>
                        <input type="number" step="any" name="x0" value="0.5" required>
                    </div>
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="5e-5" required>
                        <small><strong>IMPORTANTE:</strong> Solo son v√°lidos <strong>5e-X</strong> (Cifras Significativas) o <strong>0.5e-X</strong> (Decimales Correctos). Otros formatos como 1e-5 se tratar√°n como tolerancia gen√©rica.</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Iteraciones m√°ximas:</label>
                        <input type="number" name="niter" value="100" required>
                    </div>
                    <div class="form-group">
                        <label>M√©todo:</label>
                        <select name="metodo">
                            <option value="2" selected>Con segunda derivada (M√©todo 2)</option>
                            <option value="1">Con multiplicidad conocida (M√©todo 1)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" id="multiplicidad-group" style="display:none;">
                    <label>Multiplicidad (solo para M√©todo 1):</label>
                    <input type="number" name="multiplicidad" value="3">
                </div>
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="(x - 1)**3" required>
                    <small>Otros ejemplos: x**2 (ra√≠z doble en 0), exp(x)-x-1 (ra√≠z en 0)</small>
                </div>
                <button type="submit" class="btn btn-primary">Ejecutar</button>
            </form>
            <div id="loading-raices-multiples" class="loading"><div class="spinner"></div></div>
            <div id="resultados-raices-multiples" class="results-section"></div>
            <div id="grafica-raices-multiples" class="chart-container"></div>
        </div>

        <!-- Panel de Informe Comparativo -->
        <div id="informe" class="metodo-panel">
            <h2>üìä Informe Comparativo de M√©todos</h2>
            <div class="help-box">
                <h4>¬øQu√© hace el informe?</h4>
                <p>Ejecuta TODOS los m√©todos del cap√≠tulo con los mismos par√°metros y compara:</p>
                <ul>
                    <li>N√∫mero de iteraciones</li>
                    <li>Error final alcanzado</li>
                    <li>Ra√≠z encontrada</li>
                    <li>Tiempo de ejecuci√≥n</li>
                </ul>
                <p><strong>Resultado:</strong> Identifica cu√°l m√©todo tuvo el mejor desempe√±o.</p>
            </div>

            <form id="form-informe">
                <div class="form-group">
                    <label>Funci√≥n f(x):</label>
                    <input type="text" name="funcion" value="x**3 - 2*x - 5" required>
                    <small>Funci√≥n de prueba que funciona con todos los m√©todos</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Intervalo Xi (Bisecci√≥n/Regla Falsa):</label>
                        <input type="number" step="any" name="xi" value="2" required>
                    </div>
                    <div class="form-group">
                        <label>Intervalo Xs:</label>
                        <input type="number" step="any" name="xs" value="3" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>X0 inicial (Newton/Punto Fijo/Secante/Ra√≠ces M√∫ltiples):</label>
                        <input type="number" step="any" name="x0" value="2.5" required>
                    </div>
                    <div class="form-group">
                        <label>X1 (Secante):</label>
                        <input type="number" step="any" name="x1" value="3" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tolerancia:</label>
                        <input type="text" name="tol" value="5e-5" required>
                        <small><strong>5e-X</strong> = Cifras Significativas | <strong>0.5e-X</strong> = Decimales Correctos</small>
                    </div>
                    <div class="form-group">
                        <label>Iteraciones m√°ximas:</label>
                        <input type="number" name="niter" value="100" required>
                    </div>
                </div>

                <button type="button" class="btn btn-success" onclick="generarInforme()">üöÄ Generar Informe Comparativo</button>
            </form>

            <div id="loading-informe" class="loading"><div class="spinner"></div></div>
            <div id="resultados-informe" class="results-section"></div>
        </div>

    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/cap1.js') }}"></script>
{% endblock %}
